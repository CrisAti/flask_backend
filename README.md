# Flask Backend Distributed System

This project is a distributed system built using Docker, Docker Compose, and multiple backend services. It provides a scalable backend architecture with dedicated services for authentication, user management, and product handling, all orchestrated within containers. The system also features a simple frontend built with HTML and JavaScript to interact with the backend services.

## Features

- **Microservices Architecture**: Each core function (AUTH, USERS, PRODUCTS) runs as an independent service.
- **Containerization**: All backend services are containerized using Docker and orchestrated with Docker Compose.
- **RESTful APIs**: Each backend service exposes RESTful endpoints for easy integration.
- **Frontend**: Simple HTML and JavaScript files for interacting with backend services.
- **Scalability**: Easily scale services by adjusting Docker Compose configuration.

## Services Overview

- **AUTH**: Handles authentication, login, and token management.
- **USERS**: Manages user data and profiles.
- **PRODUCTS**: Manages product catalog and related operations.
- **GOOGLE_AUTH**: Provides Two-Factor Authentication (2FA) using Google Authenticator. Users can enable 2FA, scan a QR code, and verify TOTP codes for enhanced security. Integrates with the login flow and stores 2FA status per user.
- **Frontend**: A set of standalone HTML and JavaScript files used to interact with the backend APIs.  
  **Note:** The frontend is not containerized. You must open the HTML files directly in your browser from your host machine.

## Getting Started

### Prerequisites

- [Docker](https://www.docker.com/get-started)
- [Docker Compose](https://docs.docker.com/compose/)

### Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/CrisAti/flask_backend.git
   cd flask_backend
   ```

2. **Build and run the backend services using Docker Compose:**
   ```bash
   docker-compose up --build
   ```

3. **Access the frontend:**
   - Open the `frontend` directory in your project.
   - Double-click the HTML file you want to use (e.g., `index.html`) to open it in your browser.
   - The frontend will make API calls to the backend services running in Docker.

### Stopping the Services

To stop and remove all running containers:
```bash
docker-compose down
```

## Usage

- The frontend HTML files provide basic forms and interfaces to interact with AUTH, USERS, and PRODUCTS services.
- You can also use tools like [Postman](https://www.postman.com/) or `curl` to test the REST APIs directly.

## Project Structure

```
flask_backend/
│
├── auth/           # Authentication service (Flask app)
├── users/          # User management service (Flask app)
├── products/       # Product management service (Flask app)
├── frontend/       # HTML and JavaScript frontend (not containerized)
├── docker-compose.yml
└── README.md
```

## Customization

- To add more services, create a new directory and add its configuration to `docker-compose.yml`.
- Update the frontend to call new APIs as needed.

## Contributing

Contributions are welcome! Please open issues or pull requests for improvements and fixes.

## License

This project is licensed under the MIT License.

## Google Authenticator 2FA Service

The `GOOGLE_AUTH` microservice enables Two-Factor Authentication (2FA) for users using Google Authenticator.

### Main Features
- Generate and display a QR code for Google Authenticator setup.
- Store and manage 2FA status per user (enabled/disabled).
- Verify TOTP codes generated by the Google Authenticator app.
- Integrates with the login flow: after login, users are redirected to a 2FA verification page.

### Endpoints
- `GET /2fa/status/<user_id>`: Check if 2FA is enabled for a user.
- `POST /2fa/generate_qr/<user_id>`: Generate and return a QR code for Google Authenticator setup.
- `POST /2fa/verify`: Verify the TOTP code and enable 2FA for the user.

### Frontend Integration
- After login, users are redirected to `2fa.html`.
- If 2FA is not enabled, a QR code is shown for setup.
- Users enter the code from Google Authenticator to complete verification.
- Upon success, users are redirected to their respective dashboard (`admin.html` or `inicio.html`).

### Example Flow
1. User logs in successfully.
2. User is redirected to `/FRONTEND/2fa.html`.
3. If 2FA is not enabled, a QR code is displayed for scanning.
4. User enters the 6-digit code from Google Authenticator.
5. If the code is valid, 2FA is enabled and the user is redirected to their dashboard.

## Application Functions

### AUTH Service
- User login and authentication
- Token generation and validation
- Password hashing and verification
- Integration with Google OAuth (login with Google)

### USERS Service
- User registration (sign up)
- Retrieve user profile and details
- Update user information
- Delete user accounts
- List all users (admin only)

### PRODUCTS Service
- Add new products (admin only)
- Edit product details
- Delete products
- List all products
- Search products by name or category

### GOOGLE_AUTH Service (2FA)
- Enable/disable Two-Factor Authentication per user
- Generate and display QR code for Google Authenticator
- Verify TOTP codes from Google Authenticator
- Store and check 2FA status for each user
- Integrate 2FA into login flow for extra security

### Frontend
- Login page (`index.html`): User login, redirects to 2FA if enabled
- 2FA page (`2fa.html`): QR code display, code verification, redirects by role
- Admin dashboard (`admin.html`): Admin-only features and user/product management
- User dashboard (`inicio.html`): User features and product browsing

---

Each service is independent and communicates via REST APIs. The system is designed for modularity, security, and easy extension.
